# OLP

## Customer Obsession

私が参画していたプロジェクトは、元々分散管理されていた顧客データを統合的に管理し、更なるビジネス機会の創出につなげるためのプラットフォームを構築することが目的でした。
私がちょうどIBMに入社して2年目が終わり3年目になる頃、そのプラットフォームの一機能の開発リードを任されました。
私が担当することになった機能は、顧客の資産負債情報に関わるデータの取得、追加、更新、削除を行うAPIの開発でした。
お客様が管理する資産負債情報はデータの種類が多く、かつそれぞれのデータ構造が大きく異なっているため、当初はそれぞれのデータ構造ごとにAPIの開発を行うように工数が組まれていました。
しかし、リリースまで3スプリントほどしかなく、他のタスクにかかる工数に影響を与えており、リリースターゲットが見直されつつありました。

私はリリースターゲットの削減に伴って縮小されてしまうお客様の利益に対して何とか対策を打とうと、データ構造の見直しを始めました。

まずはお客様と会話し、要件の確認を行いました。
その中で、資産負債情報はデータ構造は異なっているが、データの扱われ方に関しては共通している部分があるということを理解しました。
それは、画面上最も頻繁に確認されるのは、共通して金額であるということです。
その他の情報は、あくまで捕捉的な情報であり、金額が最も重要で価値のあるデータでした。
そこで、データの中でどのデータ構造にも共通している金額情報を抜き出して共通テーブルとして定義し、各資産負債テーブルにはその他個別の情報を格納して、共通テーブルの外部キー参照を持たせました。
API設計では、共通テーブルを表す親エンティティに、その他個別の情報を格納した子エンティティを紐づかせることで、資産負債情報のエンティティとしてはあくまで親エンティティとして共通化させ、同一のAPIで取得、追加、更新、削除処理を行うことに成功しました。

結果的には、開発するAPIの数が当初の想定よりも88%削減されました。
そのため工数が大きく減り、その他のより多くの開発に時間を割くことが可能になったため、リリースターゲットも縮小する必要がなくなり、お客様から感謝の言葉をいただくことができました。

## Ownership

新人研修

入社して半年ほど経った時に、クラウドに関する知識を買われて、新人研修の開発ケースワークのクラウド化を任されました。
従来の開発ケースワークではECサイトをウォーターフォールに従ってローカル環境で構築した後、デモの実施も開発者のローカル環境でアプリを動かして実演するといった内容であり、時代の流れにそぐわない研修内容となっておりました。
そこでクラウド人材育成のため、クラウドを利用したアプリケーションの本番環境デプロイと、Agile開発に対応するCI/CD環境の構築経験の提供が求められており、その技術選定と研修内容の拡充を担うことになりました。

技術選定にあたり、3つの軸をもとに考えました。
それは、「再現性があること」と「能力の依存性がないこと」と「運用の負荷が少ないこと」です。
まず、「再現性があること」ですが、受講生は300人を超えるため、全ての受講生の環境で差がなく構築できる必要がありました。
また受講生の環境でトラブルが発生しても、すぐに講師の手元のPCで再現させてトラブルシューティングができるようにする必要がありました。
また、「能力の依存性がないこと」ですが、300人それぞれの能力は全くもって異なり、かつ毎年違った能力を持つ新入社員が同じ研修を受けるため、特定の能力がないと環境構築ができないといったことは避けるべきと考えました。
さらに、「運用の負荷が少ないこと」ですが、あくまでケースワークの最終的な目標はECサイトの納品なので、開発にかかる工数が大きく、環境の運用に負荷がかかるとまともに開発することができなくなってしまうので、一度環境を構築してしまえば、後は開発に専念できるように環境を放って置けるようなアーキテクチャとする必要がありました。
考えたアーキテクチャは同じクラウドの部署に所属する先輩に見てもらってレビューを受けました。
研修費用の上限が存在することを考慮できておらず、お金がかからない方法で構築することはできないかという指摘を受けたため、無料で構築できることも軸に含めて再検討し、アーキテクチャを確定させました。

アーキテクチャを確定させた後は、構築の流れを一つ一つ確認しながら手順書の作成を行いました。
操作の中で複雑な部分は簡略化させて、詳しい説明を手順書に含めるなど考慮しました。
例えば、コンテナ化する際のDockerfileはあらかじめこちらで用意しておいて、中身の詳しい説明を記述することで、能力非依存の形で手順書の構築を行いました。
また、ケースワークの前に環境構築ハンズオンとして研修の機会を設けていただき、もれなく受講生が全員環境構築を無事完了できるよう支援しました。

結果的には、当初求められていた開発ケースワークのクラウド化に成功し、これまで600人以上の新入社員の環境構築を成功させ、継続的な研修講師のアサインリクエストをいただきました。

## Invent and Simplify

karateリファクタリングの話

プロジェクトで開発していたコードはmainブランチに取り込む際に必ずIntegration Testを実行し、あらかじめ定義しておいた全てのテストがPASSすることを確認し、マージしています。
しかしテストが完了するまで45分程度の時間を要し、CIサーバーに待ちが大量に発生したり、開発ブランチがなかなかmainブランチにマージされず、依存関係のある開発になかなか着手できなかったりと、さまざまな問題を生じさせておりました。
そこでよりスムーズな開発を実現するため、テストの高速化が図れないか原因の探求とリファクタリングを行いました。

調査したところ、テスト実行の中で最も処理に時間に時間が掛かっているのは、DBにテストデータを挿入しようとしている時でした。
テストデータを挿入する際に、生のSQLをそのまま発行するのではなく、テーブルの構造をXML形式で書き、各カラムに対して変数を置き後で書き込みたいデータに置換して、フレームワークを用いてSQL文に変換するということをやっていました。
フレームワーク上の変換処理は、XMLで表現された各カラムに対してテーブルに問合せを行い、情報を確認するなど無駄な処理が多数発生していました。
テストコード上はテーブルのカラムなどが視覚的にわかりやすくなるので推奨して書いていたのですが、このSQLへの変換に多くの時間を要していたのでした。
試しにXMLを書かずに生のSQLをそのまま実行させて検証したところ、テスト時間がおよそ5分の1程度になりました。
そこで、既存のフレームワークを用いた変換処理を使わずに、XMLを読み込んで各Attributeなどを自由に扱えるオブジェクトに変換し、それを直接SQL文に組み替える処理を書いて、変換処理をリファクタリングしました。

結果的に、テストコードをほとんど変えることなく、全てのテストコードにおけるデータ挿入処理が大幅に短縮されたため、Integration Testの実行時間は5分にまで短縮され、プロジェクトメンバーから高い評価をいただきました。

## Are Right, A Lot

受講生からのリファクタリングをコードに取り入れた

新人研修ではアプリケーションとDBを別々のコンテナとして管理している。
しかしアプリケーションコンテナからDBコンテナに対する接続先URLは、ローカル環境で開発を行う際はlocalhostで宛先を指定するが、本番環境にデプロイする際にはわざわざそのURLをKubernetesのServiceコンポーネントが持つエンドポイントに書き換える必要があった。
うまくその違いを理解できていない受講生からはアプリケーションからDB内容が確認できないと質問が多く来て、毎回その対応をするためにワークロードが掛ってしまっていた。
接続先の動的な変更に関してはあまり知見がなく、手作業による変更しかないと考えて受講生に伝えていたが、
一部の受講生から、Kubernetesに環境変数を指定し、アプリケーション上でその環境変数により接続先をハンドリングすることで、手作業による変更が入らなくなるという提案を受け、
早速コード上で表現し対応したところ、特別な知識がなくても環境によって接続先の切り替えが実現でき、受講生からも質問を受け付けることもほとんどなくなった。

## Learn and Be Curious

自分の学習の軸は二つあります。
一つは自分自身の可能性を広げるためです。
例えば現職のIBMでは当時RedHatの買収が終了し、OpenShiftというコンテナオーケストレーションサービスの浸透を大きな目標にしておりましたが、私も一役買いたいと個人的にOpenShiftの勉強を始めました。
手を動かしながら学ぶことを意識していたので、RedHatが提供するハンズオンなどを一通り学習して仕組みを理解していき、勉強会などを開いて外部に発信するなどアピールをしていました。
その結果社内プロジェクトのPMの方に気づいていただき、その知識を買われて社内技術イベントホームページのバックエンド・インフラメンバーとしてお誘いをいただきました。
そのプロジェクトではバックエンドでAPIの開発と、Kubernetesに載せたコンテナの性能テストやログ連携などを担当しました。
その後はさらに幅を広げるためにKubernetesやコンテナ技術の技術書やコンポーネントの細かい仕様など、公式ドキュメントの学習を始め、対外的なアピールを繰り返し、新入社員のクラウド研修講師を任されるようにもなりました。
プロジェクトではAWSを導入する事例も非常に多く、どのプロジェクトでもパフォーマンスを発揮できるようにAWSのSolutions Architect Associateも自学で獲得することができました。
二つ目は自分の希望と能力のギャップを埋めるためです。
DXにより目覚ましく変化していくビジネス機会に適応するために多くの企業が自社基盤をクラウドに移行しており、ちょっとしたサービスから日々のインフラに係るまで、人々の生活を支えているのがクラウドです。
私は元来陰ながらでも、世界中のあらゆる人々の生活に影響を与えた人物になりたいと考えておりました。
その目標を達成するためにクラウドに関わる仕事に就くことは大きな手段の一つでした。
そのために、内定者時代はIBM Cloudの各サービスを利用した簡単なアプリケーションを開発して運用しクラウドに対するケイパビリティをアピールし、無事クラウドの部署に配属することができました。
また、OpenShiftに関するプロジェクトに関わりたかったため、OpenShiftに対するケイパビリティを証明するために、OpenShiftの資格を2つ取得するなどしてきました。
自分自身を向上させるための学習意欲は人一倍あると自覚しています。

プロジェクトに参画した時に初めて任された仕事がGo言語によるプロキシサーバーの構築でした。
お客さまの業務用端末では外部のインターネットサイトにアクセスする際に、その端末が正しく認証された端末か？アクセスしようとしているユーザーはこの端末の持ち主かどうかを認証するためにプロキシサーバーの構築が求められていました。
私が参画したタイミングがちょうどその要件調整と設計が終わった段階であり、私に割り当てられたのはGo言語によるプロキシサーバーの開発でした。

Go言語に関する知識が皆無だった私は、まず内部アプリ向けに作られたプロキシサーバーのコードリーディングを始め、サーバーの構成を理解しつつGo言語を学ぶことにしました。
Go言語と言っても開発するアプリケーションやサービスによって書き方は大きく異なるため、同じプロキシサーバーとして構築されているコードを読むことで効率的に学べると思ったからです。
ローカル環境でコードを一部変更して動きを確かめたり、構成がわかってくると勉強会を開いてその認識が正しいかチームメンバーにアドバイスをいただいたりして学び、約一ヶ月ほどで大体のプロキシサーバーの構成をコーディングできるようになりました。
特に理解が難しく進捗が滞っている箇所に関しては、積極的にチームメンバーにペアプログラミングを求めて直接コードの指導をいただくことでスピード感を持って学ぶことができました。

結果的に、プロキシサーバーは2ヶ月ほどで結合テストまで終えることができ、チームリーダーからは学習意欲と適応力の高さを評価いただきました。

## Hire and Develop the Best

コードレビュー？コードのリファクタリング？N+1問題？勉強会？

## Insist on the Highest Standards

リリーススクリプトの開発

## Think Big

新人研修を上級者のみに実施してきたが初級者にも簡単に実施可能とするためにリファクタリグした。

## Bias for Action

新人研修で一部在庫管理処理などはAPIとして提供するなどして、開発者がより効率的にかつ幅広い知識を学ぶことができるか実験的に試すなどした。

## Frugality

新人研修は大掛かりなことをしたにもかかわらず、一切お金がかかっていない
方針を考える際もお金がかからない方法で検証を繰り返した。

## Earn Trust

N＋1問題が発覚、対処した経験

新人研修でコードのリファクタリングを求められた際の対応

## Dive Deep

ソフィアとの要件調整でわからないところや理解できない部分はとことん理解するまで調整を行った。

後はLean Coffeeなどで問題提起したことなどを挙げる。

## Have Backbone; Disagree and Commit

推進リスト削除バッチでSQLのリファクタリングが必要そうならその対応を行ったこと？

## Deliver Results

新人研修で難しい要件にも対応したこと

## Strive to be Earth's Best Employer

## Success and Scale Bring Broad Responsibility
